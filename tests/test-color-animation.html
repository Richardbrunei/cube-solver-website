<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Color Display Animation</title>
    <link rel="stylesheet" href="../styles/camera.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            margin-top: 0;
            color: #333;
        }
        
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .test-section h2 {
            margin-top: 0;
            font-size: 1.2rem;
            color: #667eea;
        }
        
        .test-grid-container {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
        }
        
        .test-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 0.75rem 1.5rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s;
        }
        
        .test-btn:hover {
            background: #5568d3;
        }
        
        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .test-result {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #28a745;
        }
        
        .test-result.error {
            border-left-color: #dc3545;
        }
        
        .test-result pre {
            margin: 0.5rem 0 0 0;
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🎨 Color Display Animation Test</h1>
        <p>This page tests the color display animation feature for the camera capture interface.</p>
        
        <div class="test-section">
            <h2>Test Grid</h2>
            <p>The grid below simulates the camera preview overlay with 9 sampling cells.</p>
            
            <div class="test-grid-container">
                <div class="camera-preview__frame">
                    <div class="sampling-grid">
                        <div class="sampling-grid__row">
                            <div class="sampling-cell" data-position="0">
                                <span class="cell-color-label"></span>
                            </div>
                            <div class="sampling-cell" data-position="1">
                                <span class="cell-color-label"></span>
                            </div>
                            <div class="sampling-cell" data-position="2">
                                <span class="cell-color-label"></span>
                            </div>
                        </div>
                        <div class="sampling-grid__row">
                            <div class="sampling-cell" data-position="3">
                                <span class="cell-color-label"></span>
                            </div>
                            <div class="sampling-cell sampling-cell--center" data-position="4">
                                <span class="cell-color-label"></span>
                            </div>
                            <div class="sampling-cell" data-position="5">
                                <span class="cell-color-label"></span>
                            </div>
                        </div>
                        <div class="sampling-grid__row">
                            <div class="sampling-cell" data-position="6">
                                <span class="cell-color-label"></span>
                            </div>
                            <div class="sampling-cell" data-position="7">
                                <span class="cell-color-label"></span>
                            </div>
                            <div class="sampling-cell" data-position="8">
                                <span class="cell-color-label"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>Test Controls</h2>
            <div class="test-buttons">
                <button class="test-btn" id="test-single-color">Test Single Color</button>
                <button class="test-btn" id="test-sequential">Test Sequential Animation</button>
                <button class="test-btn" id="test-contrast">Test Contrast Colors</button>
                <button class="test-btn" id="test-clear">Clear Grid</button>
            </div>
            <div id="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Test Results</h2>
            <ul id="test-log"></ul>
        </div>
    </div>
    
    <script type="module">
        // Helper functions matching CameraCapture implementation
        
        function displayDetectedColor(position, color, colorName) {
            const cell = document.querySelector(`.sampling-cell[data-position="${position}"]`);
            
            if (!cell) {
                console.warn(`Cell at position ${position} not found`);
                return;
            }
            
            const label = cell.querySelector('.cell-color-label');
            
            // Add detecting animation
            cell.classList.add('sampling-cell--detecting');
            
            // After brief delay, show detected color
            setTimeout(() => {
                cell.classList.remove('sampling-cell--detecting');
                cell.classList.add('sampling-cell--detected');
                
                // Set background color
                cell.style.backgroundColor = color;
                
                // Set text color based on brightness
                const textColor = getContrastColor(color);
                if (label) {
                    label.style.color = textColor;
                    label.textContent = colorName;
                }
            }, 300);
        }
        
        async function animateColorDetection(colors) {
            const colorToHex = {
                'White': '#FFFFFF',
                'Red': '#FF0000',
                'Green': '#00FF00',
                'Yellow': '#FFFF00',
                'Orange': '#FFA500',
                'Blue': '#0000FF',
                'U': '#FFFFFF',
                'R': '#FF0000',
                'F': '#00FF00',
                'D': '#FFFF00',
                'L': '#FFA500',
                'B': '#0000FF'
            };
            
            for (let i = 0; i < colors.length; i++) {
                const colorName = colors[i];
                const hexColor = colorToHex[colorName] || '#CCCCCC';
                
                displayDetectedColor(i, hexColor, colorName);
                
                await new Promise(resolve => setTimeout(resolve, 200));
            }
        }
        
        function getContrastColor(hexColor) {
            const hex = hexColor.replace('#', '');
            
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
            
            return luminance > 0.5 ? 'black' : 'white';
        }
        
        function clearGridColors() {
            const cells = document.querySelectorAll('.sampling-cell');
            
            cells.forEach(cell => {
                cell.classList.remove('sampling-cell--detecting', 'sampling-cell--detected');
                cell.style.backgroundColor = '';
                
                const label = cell.querySelector('.cell-color-label');
                if (label) {
                    label.textContent = '';
                    label.style.color = '';
                }
            });
        }
        
        function logTest(message, success = true) {
            const log = document.getElementById('test-log');
            const li = document.createElement('li');
            li.textContent = `${success ? '✅' : '❌'} ${message}`;
            li.style.color = success ? '#28a745' : '#dc3545';
            log.appendChild(li);
        }
        
        // Test: Single color display
        document.getElementById('test-single-color').addEventListener('click', () => {
            clearGridColors();
            logTest('Testing single color display at position 4 (center)');
            displayDetectedColor(4, '#FF0000', 'R');
            setTimeout(() => {
                const cell = document.querySelector('.sampling-cell[data-position="4"]');
                const hasColor = cell.style.backgroundColor === 'rgb(255, 0, 0)';
                const hasLabel = cell.querySelector('.cell-color-label').textContent === 'R';
                logTest(`Single color display: ${hasColor && hasLabel ? 'PASSED' : 'FAILED'}`, hasColor && hasLabel);
            }, 500);
        });
        
        // Test: Sequential animation
        document.getElementById('test-sequential').addEventListener('click', async () => {
            clearGridColors();
            logTest('Testing sequential animation with 9 colors');
            const colors = ['U', 'R', 'F', 'D', 'L', 'B', 'U', 'R', 'F'];
            await animateColorDetection(colors);
            logTest('Sequential animation completed');
        });
        
        // Test: Contrast colors
        document.getElementById('test-contrast').addEventListener('click', () => {
            clearGridColors();
            logTest('Testing contrast color calculation');
            
            const testCases = [
                { color: '#FFFFFF', expected: 'black', name: 'White' },
                { color: '#000000', expected: 'white', name: 'Black' },
                { color: '#FF0000', expected: 'white', name: 'Red' },
                { color: '#FFFF00', expected: 'black', name: 'Yellow' }
            ];
            
            testCases.forEach((test, index) => {
                const result = getContrastColor(test.color);
                const passed = result === test.expected;
                logTest(`Contrast for ${test.name} (${test.color}): expected ${test.expected}, got ${result}`, passed);
                
                // Display on grid
                if (index < 9) {
                    displayDetectedColor(index, test.color, test.name[0]);
                }
            });
        });
        
        // Test: Clear grid
        document.getElementById('test-clear').addEventListener('click', () => {
            clearGridColors();
            logTest('Grid cleared');
            
            setTimeout(() => {
                const cells = document.querySelectorAll('.sampling-cell');
                let allCleared = true;
                cells.forEach(cell => {
                    if (cell.style.backgroundColor || 
                        cell.classList.contains('sampling-cell--detected') ||
                        cell.classList.contains('sampling-cell--detecting')) {
                        allCleared = false;
                    }
                });
                logTest(`Clear grid: ${allCleared ? 'PASSED' : 'FAILED'}`, allCleared);
            }, 100);
        });
        
        // Initial log
        logTest('Test page loaded successfully');
    </script>
</body>
</html>
