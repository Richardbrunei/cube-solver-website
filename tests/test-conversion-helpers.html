<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversion Helper Functions Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .pass {
            background-color: #d4edda;
            color: #155724;
        }
        .fail {
            background-color: #f8d7da;
            color: #721c24;
        }
        h2 {
            color: #333;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Conversion Helper Functions Test</h1>
    <div id="test-results"></div>

    <script src="../scripts/cube-state.js"></script>
    <script>
        const resultsDiv = document.getElementById('test-results');
        let testsPassed = 0;
        let testsFailed = 0;

        function addTestResult(testName, passed, message = '') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'pass' : 'fail'}`;
            resultDiv.innerHTML = `
                <strong>${passed ? '✓' : '✗'} ${testName}</strong>
                ${message ? `<br><small>${message}</small>` : ''}
            `;
            resultsDiv.appendChild(resultDiv);

            if (passed) {
                testsPassed++;
            } else {
                testsFailed++;
            }
        }

        function runTests() {
            const cubeState = new CubeState();

            // Test 1: colorArrayToString - basic conversion
            try {
                const testArray = [
                    ['U', 'U', 'U'],
                    ['U', 'U', 'U'],
                    ['U', 'U', 'U']
                ];
                const result = cubeState.colorArrayToString(testArray);
                const expected = 'UUUUUUUUU';
                addTestResult(
                    'colorArrayToString - basic conversion',
                    result === expected,
                    `Expected: "${expected}", Got: "${result}"`
                );
            } catch (error) {
                addTestResult('colorArrayToString - basic conversion', false, error.message);
            }

            // Test 2: colorArrayToString - mixed colors
            try {
                const testArray = [
                    ['U', 'R', 'F'],
                    ['D', 'L', 'B'],
                    ['U', 'R', 'F']
                ];
                const result = cubeState.colorArrayToString(testArray);
                const expected = 'URFDLBURF';
                addTestResult(
                    'colorArrayToString - mixed colors',
                    result === expected,
                    `Expected: "${expected}", Got: "${result}"`
                );
            } catch (error) {
                addTestResult('colorArrayToString - mixed colors', false, error.message);
            }

            // Test 3: colorArrayToString - invalid input (not array)
            try {
                cubeState.colorArrayToString('not an array');
                addTestResult('colorArrayToString - invalid input (not array)', false, 'Should have thrown error');
            } catch (error) {
                addTestResult(
                    'colorArrayToString - invalid input (not array)',
                    error.message.includes('must be an array'),
                    `Error: ${error.message}`
                );
            }

            // Test 4: colorArrayToString - wrong number of rows
            try {
                cubeState.colorArrayToString([['U', 'U', 'U'], ['U', 'U', 'U']]);
                addTestResult('colorArrayToString - wrong number of rows', false, 'Should have thrown error');
            } catch (error) {
                addTestResult(
                    'colorArrayToString - wrong number of rows',
                    error.message.includes('expected 3 rows'),
                    `Error: ${error.message}`
                );
            }

            // Test 5: colorArrayToString - wrong number of columns
            try {
                cubeState.colorArrayToString([['U', 'U'], ['U', 'U'], ['U', 'U']]);
                addTestResult('colorArrayToString - wrong number of columns', false, 'Should have thrown error');
            } catch (error) {
                addTestResult(
                    'colorArrayToString - wrong number of columns',
                    error.message.includes('expected 3'),
                    `Error: ${error.message}`
                );
            }

            // Test 6: stringToColorArray - basic conversion
            try {
                const testString = 'UUUUUUUUU';
                const result = cubeState.stringToColorArray(testString);
                const expected = [
                    ['U', 'U', 'U'],
                    ['U', 'U', 'U'],
                    ['U', 'U', 'U']
                ];
                const matches = JSON.stringify(result) === JSON.stringify(expected);
                addTestResult(
                    'stringToColorArray - basic conversion',
                    matches,
                    `Expected: ${JSON.stringify(expected)}, Got: ${JSON.stringify(result)}`
                );
            } catch (error) {
                addTestResult('stringToColorArray - basic conversion', false, error.message);
            }

            // Test 7: stringToColorArray - mixed colors
            try {
                const testString = 'URFDLBURF';
                const result = cubeState.stringToColorArray(testString);
                const expected = [
                    ['U', 'R', 'F'],
                    ['D', 'L', 'B'],
                    ['U', 'R', 'F']
                ];
                const matches = JSON.stringify(result) === JSON.stringify(expected);
                addTestResult(
                    'stringToColorArray - mixed colors',
                    matches,
                    `Expected: ${JSON.stringify(expected)}, Got: ${JSON.stringify(result)}`
                );
            } catch (error) {
                addTestResult('stringToColorArray - mixed colors', false, error.message);
            }

            // Test 8: stringToColorArray - invalid input (not string)
            try {
                cubeState.stringToColorArray(['not', 'a', 'string']);
                addTestResult('stringToColorArray - invalid input (not string)', false, 'Should have thrown error');
            } catch (error) {
                addTestResult(
                    'stringToColorArray - invalid input (not string)',
                    error.message.includes('must be a string'),
                    `Error: ${error.message}`
                );
            }

            // Test 9: stringToColorArray - wrong length
            try {
                cubeState.stringToColorArray('UUUUU');
                addTestResult('stringToColorArray - wrong length', false, 'Should have thrown error');
            } catch (error) {
                addTestResult(
                    'stringToColorArray - wrong length',
                    error.message.includes('expected 9 characters'),
                    `Error: ${error.message}`
                );
            }

            // Test 10: Round-trip conversion (array -> string -> array)
            try {
                const originalArray = [
                    ['U', 'R', 'F'],
                    ['D', 'L', 'B'],
                    ['U', 'R', 'F']
                ];
                const string = cubeState.colorArrayToString(originalArray);
                const resultArray = cubeState.stringToColorArray(string);
                const matches = JSON.stringify(originalArray) === JSON.stringify(resultArray);
                addTestResult(
                    'Round-trip conversion (array -> string -> array)',
                    matches,
                    `Original: ${JSON.stringify(originalArray)}, Result: ${JSON.stringify(resultArray)}`
                );
            } catch (error) {
                addTestResult('Round-trip conversion (array -> string -> array)', false, error.message);
            }

            // Test 11: Round-trip conversion (string -> array -> string)
            try {
                const originalString = 'URFDLBURF';
                const array = cubeState.stringToColorArray(originalString);
                const resultString = cubeState.colorArrayToString(array);
                addTestResult(
                    'Round-trip conversion (string -> array -> string)',
                    originalString === resultString,
                    `Original: "${originalString}", Result: "${resultString}"`
                );
            } catch (error) {
                addTestResult('Round-trip conversion (string -> array -> string)', false, error.message);
            }

            // Display summary
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'test-section';
            summaryDiv.innerHTML = `
                <h2>Test Summary</h2>
                <p><strong>Total Tests:</strong> ${testsPassed + testsFailed}</p>
                <p><strong>Passed:</strong> ${testsPassed}</p>
                <p><strong>Failed:</strong> ${testsFailed}</p>
            `;
            resultsDiv.appendChild(summaryDiv);

            console.log(`Tests completed: ${testsPassed} passed, ${testsFailed} failed`);
        }

        // Run tests when page loads
        window.addEventListener('load', runTests);
    </script>
</body>
</html>
