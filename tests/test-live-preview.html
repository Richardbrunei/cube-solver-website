<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Live Color Preview</title>
    <link rel="stylesheet" href="../styles/camera.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            margin-top: 0;
            color: #333;
        }
        
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .test-section h2 {
            margin-top: 0;
            font-size: 1.2rem;
            color: #667eea;
        }
        
        .test-grid-container {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
            background: #000;
            padding: 2rem;
            border-radius: 8px;
        }
        
        .test-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 0.75rem 1.5rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s;
        }
        
        .test-btn:hover {
            background: #5568d3;
        }
        
        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .test-btn.active {
            background: #28a745;
        }
        
        .status-display {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #667eea;
        }
        
        .status-display strong {
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ðŸ“¹ Live Color Preview Test</h1>
        <p>This page tests the live color preview feature that shows detected colors in real-time as you position the cube.</p>
        
        <div class="test-section">
            <h2>Live Preview Grid</h2>
            <p>The grid below simulates the camera overlay with live color detection.</p>
            
            <div class="test-grid-container">
                <div class="camera-preview__frame">
                    <div class="sampling-grid">
                        <div class="sampling-grid__row">
                            <div class="sampling-cell" data-position="0">
                                <span class="cell-color-label"></span>
                            </div>
                            <div class="sampling-cell" data-position="1">
                                <span class="cell-color-label"></span>
                            </div>
                            <div class="sampling-cell" data-position="2">
                                <span class="cell-color-label"></span>
                            </div>
                        </div>
                        <div class="sampling-grid__row">
                            <div class="sampling-cell" data-position="3">
                                <span class="cell-color-label"></span>
                            </div>
                            <div class="sampling-cell sampling-cell--center" data-position="4">
                                <span class="cell-color-label"></span>
                            </div>
                            <div class="sampling-cell" data-position="5">
                                <span class="cell-color-label"></span>
                            </div>
                        </div>
                        <div class="sampling-grid__row">
                            <div class="sampling-cell" data-position="6">
                                <span class="cell-color-label"></span>
                            </div>
                            <div class="sampling-cell" data-position="7">
                                <span class="cell-color-label"></span>
                            </div>
                            <div class="sampling-cell" data-position="8">
                                <span class="cell-color-label"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>Test Controls</h2>
            <div class="test-buttons">
                <button class="test-btn" id="start-preview">Start Live Preview</button>
                <button class="test-btn" id="stop-preview">Stop Live Preview</button>
                <button class="test-btn" id="simulate-movement">Simulate Cube Movement</button>
                <button class="test-btn" id="clear-grid">Clear Grid</button>
            </div>
            <div class="status-display">
                <strong>Status:</strong> <span id="status-text">Ready</span>
            </div>
        </div>
        
        <div class="test-section">
            <h2>Feature Description</h2>
            <ul>
                <li><strong>Live Preview:</strong> Colors update every 500ms while camera is active</li>
                <li><strong>Smooth Transitions:</strong> CSS transitions provide smooth color changes</li>
                <li><strong>Semi-Transparent:</strong> Live preview uses 70% opacity to distinguish from captured colors</li>
                <li><strong>Auto-Start:</strong> Preview starts automatically when video loads</li>
                <li><strong>Auto-Stop:</strong> Preview stops during capture and when camera closes</li>
            </ul>
        </div>
    </div>
    
    <script type="module">
        let previewInterval = null;
        let isPreviewActive = false;
        
        // Color notation to hex mapping
        const colorToHex = {
            'U': '#FFFFFF',  // White
            'R': '#FF0000',  // Red
            'F': '#00FF00',  // Green
            'D': '#FFFF00',  // Yellow
            'L': '#FFA500',  // Orange
            'B': '#0000FF'   // Blue
        };
        
        const colorNames = ['U', 'R', 'F', 'D', 'L', 'B'];
        
        function getContrastColor(hexColor) {
            const hex = hexColor.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
            return luminance > 0.5 ? 'black' : 'white';
        }
        
        function notationToColorName(notation) {
            const notationToName = {
                'U': 'White',
                'R': 'Red',
                'F': 'Green',
                'D': 'Yellow',
                'L': 'Orange',
                'B': 'Blue'
            };
            return notationToName[notation] || notation;
        }
        
        function displayLiveColors(colors) {
            colors.forEach((color, index) => {
                const cell = document.querySelector(`.sampling-cell[data-position="${index}"]`);
                if (!cell) return;
                
                const label = cell.querySelector('.cell-color-label');
                const hexColor = colorToHex[color.name] || color.hex;
                
                // Update cell with smooth transition
                cell.style.backgroundColor = hexColor;
                cell.style.opacity = '0.7'; // Semi-transparent for live preview
                
                if (label) {
                    const textColor = getContrastColor(hexColor);
                    label.style.color = textColor;
                    // Convert notation to color name
                    const colorName = notationToColorName(color.name);
                    label.textContent = colorName;
                }
            });
        }
        
        function generateRandomColors() {
            const colors = [];
            for (let i = 0; i < 9; i++) {
                const randomColor = colorNames[Math.floor(Math.random() * colorNames.length)];
                colors.push({
                    name: randomColor,
                    hex: colorToHex[randomColor]
                });
            }
            return colors;
        }
        
        function startLivePreview() {
            if (isPreviewActive) return;
            
            isPreviewActive = true;
            document.getElementById('start-preview').classList.add('active');
            document.getElementById('status-text').textContent = 'Live preview active - colors updating every 500ms';
            
            previewInterval = setInterval(() => {
                const colors = generateRandomColors();
                displayLiveColors(colors);
            }, 500);
        }
        
        function stopLivePreview() {
            if (!isPreviewActive) return;
            
            isPreviewActive = false;
            document.getElementById('start-preview').classList.remove('active');
            document.getElementById('status-text').textContent = 'Live preview stopped';
            
            if (previewInterval) {
                clearInterval(previewInterval);
                previewInterval = null;
            }
        }
        
        function clearGrid() {
            const cells = document.querySelectorAll('.sampling-cell');
            cells.forEach(cell => {
                cell.style.backgroundColor = '';
                cell.style.opacity = '';
                const label = cell.querySelector('.cell-color-label');
                if (label) {
                    label.textContent = '';
                    label.style.color = '';
                }
            });
            document.getElementById('status-text').textContent = 'Grid cleared';
        }
        
        function simulateMovement() {
            document.getElementById('status-text').textContent = 'Simulating cube movement...';
            
            // Simulate 5 quick updates
            let count = 0;
            const movementInterval = setInterval(() => {
                const colors = generateRandomColors();
                displayLiveColors(colors);
                count++;
                
                if (count >= 5) {
                    clearInterval(movementInterval);
                    document.getElementById('status-text').textContent = 'Movement simulation complete';
                }
            }, 300);
        }
        
        // Event listeners
        document.getElementById('start-preview').addEventListener('click', startLivePreview);
        document.getElementById('stop-preview').addEventListener('click', stopLivePreview);
        document.getElementById('simulate-movement').addEventListener('click', simulateMovement);
        document.getElementById('clear-grid').addEventListener('click', clearGrid);
        
        // Auto-start preview on load
        setTimeout(() => {
            startLivePreview();
        }, 500);
    </script>
</body>
</html>
