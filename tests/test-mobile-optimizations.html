<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Performance Optimizations Test</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/cube.css">
    <link rel="stylesheet" href="../styles/animation.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .test-result.pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-result.fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #5568d3;
        }
        .device-info {
            font-family: monospace;
            font-size: 14px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <h1>Mobile Performance Optimizations Test</h1>
    
    <div class="test-section">
        <h2>Device Detection</h2>
        <div id="device-detection-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Animation Test</h2>
        <p>Click the button below to test the animation with mobile optimizations:</p>
        <button id="test-animation-btn">Test Animation</button>
        <div id="animation-results"></div>
    </div>
    
    <div class="test-section">
        <h2>CSS Optimization Test</h2>
        <div id="css-results"></div>
    </div>

    <script type="module">
        import { AnimationController } from '../scripts/animation-controller.js';
        
        // Test device detection
        function testDeviceDetection() {
            const resultsDiv = document.getElementById('device-detection-results');
            
            // Create a temporary AnimationController to test detection
            const controller = new AnimationController();
            
            const isMobile = controller.isMobile;
            const isLowEnd = controller.isLowEndDevice;
            
            const userAgent = navigator.userAgent;
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            const cores = navigator.hardwareConcurrency || 'unknown';
            const memory = navigator.deviceMemory || 'unknown';
            const hasTouch = 'ontouchstart' in window;
            
            resultsDiv.innerHTML = `
                <div class="test-result info">
                    <strong>Device Information:</strong>
                    <div class="device-info">
                        User Agent: ${userAgent}<br>
                        Screen Size: ${screenWidth}x${screenHeight}<br>
                        CPU Cores: ${cores}<br>
                        Device Memory: ${memory} GB<br>
                        Touch Support: ${hasTouch}<br>
                        <br>
                        <strong>Detection Results:</strong><br>
                        Is Mobile: ${isMobile}<br>
                        Is Low-End Device: ${isLowEnd}
                    </div>
                </div>
                <div class="test-result ${isMobile ? 'pass' : 'info'}">
                    ${isMobile ? '✓ Mobile device detected' : 'ℹ Desktop device detected'}
                </div>
                <div class="test-result ${isLowEnd ? 'pass' : 'info'}">
                    ${isLowEnd ? '✓ Low-end device detected - additional optimizations will be applied' : 'ℹ Standard device - normal optimizations will be applied'}
                </div>
            `;
        }
        
        // Test animation with mobile optimizations
        function testAnimation() {
            const resultsDiv = document.getElementById('animation-results');
            resultsDiv.innerHTML = '<div class="test-result info">Starting animation test...</div>';
            
            try {
                const controller = new AnimationController();
                
                // Test with a simple move sequence
                const moves = ['R', 'U', "R'", 'U', 'R', 'U2', "R'"];
                const solvedCube = 'UUUUUUUUURRRRRRRRRFFFFFFFFFDDDDDDDDDLLLLLLLLLBBBBBBBBB';
                
                controller.startAnimation(moves, solvedCube);
                
                // Check if mobile optimizations were applied
                setTimeout(() => {
                    const cubeWrapper = document.querySelector('.anim-cube-3d');
                    
                    if (!cubeWrapper) {
                        resultsDiv.innerHTML = '<div class="test-result fail">✗ Animation failed to render</div>';
                        return;
                    }
                    
                    const hasMobileClass = cubeWrapper.classList.contains('anim-cube-3d--mobile');
                    const hasLowEndClass = cubeWrapper.classList.contains('anim-cube-3d--low-end');
                    const hasAnimation = window.getComputedStyle(cubeWrapper).animation !== 'none';
                    
                    let results = '<div class="test-result pass">✓ Animation rendered successfully</div>';
                    
                    if (controller.isMobile) {
                        results += `<div class="test-result ${hasMobileClass ? 'pass' : 'fail'}">
                            ${hasMobileClass ? '✓' : '✗'} Mobile class applied to cube wrapper
                        </div>`;
                        
                        results += `<div class="test-result ${!hasAnimation ? 'pass' : 'fail'}">
                            ${!hasAnimation ? '✓' : '✗'} Floating animation disabled on mobile
                        </div>`;
                    }
                    
                    if (controller.isLowEndDevice) {
                        results += `<div class="test-result ${hasLowEndClass ? 'pass' : 'fail'}">
                            ${hasLowEndClass ? '✓' : '✗'} Low-end device class applied
                        </div>`;
                    }
                    
                    // Check for will-change hints
                    const willChange = window.getComputedStyle(cubeWrapper).willChange;
                    results += `<div class="test-result ${willChange.includes('transform') ? 'pass' : 'info'}">
                        ${willChange.includes('transform') ? '✓' : 'ℹ'} will-change hint: ${willChange || 'auto'}
                    </div>`;
                    
                    resultsDiv.innerHTML = results;
                }, 100);
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="test-result fail">✗ Error: ${error.message}</div>`;
            }
        }
        
        // Test CSS optimizations
        function testCSSOptimizations() {
            const resultsDiv = document.getElementById('css-results');
            
            // Create a test cube element
            const testCube = document.createElement('div');
            testCube.className = 'anim-cube-3d';
            testCube.style.visibility = 'hidden';
            testCube.style.position = 'absolute';
            document.body.appendChild(testCube);
            
            const styles = window.getComputedStyle(testCube);
            const willChange = styles.willChange;
            const backfaceVisibility = styles.backfaceVisibility || styles.webkitBackfaceVisibility;
            
            let results = '<div class="test-result info"><strong>CSS Properties:</strong></div>';
            
            results += `<div class="test-result ${willChange !== 'auto' ? 'pass' : 'info'}">
                will-change: ${willChange}
            </div>`;
            
            results += `<div class="test-result ${backfaceVisibility === 'hidden' ? 'pass' : 'info'}">
                backface-visibility: ${backfaceVisibility || 'not set'}
            </div>`;
            
            // Test mobile-specific class
            testCube.classList.add('anim-cube-3d--mobile');
            const mobileStyles = window.getComputedStyle(testCube);
            const mobileAnimation = mobileStyles.animation;
            
            results += `<div class="test-result ${mobileAnimation === 'none' ? 'pass' : 'info'}">
                Mobile animation disabled: ${mobileAnimation === 'none' ? 'Yes' : 'No'}
            </div>`;
            
            // Cleanup
            document.body.removeChild(testCube);
            
            resultsDiv.innerHTML = results;
        }
        
        // Run tests on load
        testDeviceDetection();
        testCSSOptimizations();
        
        // Set up button handler
        document.getElementById('test-animation-btn').addEventListener('click', testAnimation);
    </script>
</body>
</html>
